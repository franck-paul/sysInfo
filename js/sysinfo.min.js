$(()=>{dotclear.mergeDeep(dotclear, dotclear.getData('sysinfo'));var dotclearAjax=(method, args, fn, msg = '')=>{var content=null,params={xd_check:dotclear.nonce,f:method,};$.extend(params, args);var promise=$.ajax({url:'services.php',data:params,dataType:'xml',});promise.done((data)=>{if($('rsp[status=failed]', data).length>0) {window.console.log('Dotclear REST server error');return;}var ret=+$('rsp>sysinfo', data).attr('ret');content = $('rsp>sysinfo', data).attr('msg');if(ret&&fn!==void 0&&typeof fn==='function') {fn(content);}if(!ret&&msg!=='') {window.alert(msg);}});},getStaticCacheFilename=(url, fn)=>dotclearAjax('getStaticCacheName', {url,}, fn, ''),loadStaticCacheDirs=(dir, fn)=>dotclearAjax('getStaticCacheDir', {root:dir,}, fn, ''),loadStaticCacheList=(dir, fn)=>dotclearAjax('getStaticCacheList', {root:dir,}, fn, ''),loadServerFile=(filename, type, fn)=>{switch(type) {case 'tpl':dotclearAjax('getCompiledTemplate', {file:filename,}, fn, dotclear.msg.tpl_not_found);break;case 'sc':dotclearAjax('getStaticCacheFile', {file:filename,}, fn, dotclear.msg.sc_not_found);break;}},viewSource=(prefix, filename, content)=>{var cm_editor,src=`<div class="${prefix}_view"><h1>${filename}</h1><textarea id="${prefix}_source">${JSON.parse(window.atob(content))}</textarea></div>`;$.magnificPopup.open({items:{src,type:'inline',},callbacks:{open:()=>{if(dotclear.colorsyntax) {var options={mode:'text/html',tabMode:'indent',lineWrapping:'true',lineNumbers:'true',matchBrackets:'true',autoCloseBrackets:'true',readOnly:'true',};if(dotclear.colorsyntax_theme!=='') {options.theme = dotclear.colorsyntax_theme;}var textarea=document.getElementById(`${prefix}_source`);cm_editor = CodeMirror.fromTextArea(textarea, options);}},close:()=>{if(cm_editor!=null) {cm_editor.toTextArea();}},},});};$('a.tpl_compiled').on('click', (e)=>{e.preventDefault();var template_file=$(e.target).text();if(template_file!==void 0) {loadServerFile(template_file, 'tpl', (content)=>{viewSource('tpl_compiled', template_file, content);});}});$('a.sc_dir').on('click', (e)=>{e.preventDefault();var main_dir=$(e.target).text();loadStaticCacheDirs(main_dir, (dirs)=>{var r=$(e.target).parent().parent();r.after(dirs).remove();$('a.sc_subdir').on('click', (f)=>{f.preventDefault();var sub_dir=$(f.target).text();loadStaticCacheList(`${main_dir}/${sub_dir}`, (list)=>{$('a.sc_compiled').off('click');var s=$(f.target).parent().parent();s.after(list).remove();dotclear.condSubmit('#scform td input[type=checkbox]', '#scform #delscaction');$('a.sc_compiled').on('click', (g)=>{g.preventDefault();var cache_file=$(g.target).attr('data-file');if(cache_file!==void 0) {loadServerFile(cache_file, 'sc', (content)=>{viewSource('sc_compiled', $(g.target).text(), content);});}});});});});});$('#checklist').on('change', function() {this.form.submit();});$('#getscaction').on('click', (e)=>{e.preventDefault();$('#sccalc_res').text('');$('#sccalc_preview').text('').off('click');var url=$('#sccalc_url').val();if(url!==void 0&&url!=='') {getStaticCacheFilename(url, (res)=>{var text=`${String.fromCharCode(160)+res.slice(0, 2)} / ${res.slice(2, 4)} / ${res.slice(4, 6)} / `;$('#sccalc_res').text(text);$('#sccalc_preview').text(res).trigger('focus');$('#sccalc_preview').on('click', (f)=>{f.preventDefault();var cache_file=`${res.slice(0, 2)}/${res.slice(2, 4)}/${res.slice(4, 6)}/${res}`;loadServerFile(`${$(f.target).attr('data-dir')}/${cache_file}`, 'sc', (content)=>{viewSource('sc_compiled', res, content);});});});}});$('#tplform .checkboxes-helpers').each(function() {dotclear.checkboxesHelpers(this, void 0, '#tplform td input[type=checkbox]:not(:disabled)', '#tplform #deltplaction');});$('#tplform td input[type=checkbox]').enableShiftClick();dotclear.condSubmit('#tplform td input[type=checkbox]', '#tplform #deltplaction');$('form input[type=submit][name=deltplaction]').on('click', ()=>window.confirm(dotclear.msg.confirm_del_tpl));$('#verform .checkboxes-helpers').each(function() {dotclear.checkboxesHelpers(this, void 0, '#verform td input[type=checkbox]:not(:disabled)', '#verform #delveraction');});$('#verform td input[type=checkbox]').enableShiftClick();dotclear.condSubmit('#verform td input[type=checkbox]', '#verform #delveraction');$('form input[type=submit][name=delveraction]').on('click', ()=>window.confirm(dotclear.msg.confirm_del_ver));$('#scform .checkboxes-helpers').each(function() {dotclear.checkboxesHelpers(this, void 0, '#scform td input[type=checkbox]:not(:disabled)', '#scform #delscaction');});$('#scform td input[type=checkbox]').enableShiftClick();dotclear.condSubmit('#scform td input[type=checkbox]', '#scform #delscaction');$('form input[type=submit][name=delscaction]').on('click', ()=>window.confirm(dotclear.msg.confirm_del_sc));$('#expand-all').on('click', function(e) {e.preventDefault();if($(this).attr('open')) {$('#content details').each(function() {$(this).attr('open', !1);});} else {$('#content details').each(function() {$(this).attr('open', !0);});}});});
