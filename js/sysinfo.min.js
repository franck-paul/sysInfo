"use strict";dotclear.ready((()=>{dotclear.mergeDeep(dotclear,dotclear.getData("sysinfo"));const e=(e,t,o,r="")=>{dotclear.jsonServicesGet(e,(e=>{o(e.html)}),t,(e=>{dotclear.debug&&console.log(e),window.alert(r)}))},t=(t,o,r)=>{switch(o){case"tpl":e("getCompiledTemplate",{file:t},r,dotclear.msg.tpl_not_found);break;case"sc":e("getStaticCacheFile",{file:t},r,dotclear.msg.sc_not_found)}},o=(e,t,o,r,c="")=>{let n;const l=""===c?"":`${c} - `,s=`<div class="${e}_view"><h1>${l}${t}</h1><textarea id="${e}_source">${JSON.parse(window.atob(o))}</textarea></div>`;jQuery.magnificPopup.open({items:{src:s,type:"inline"},callbacks:{open:()=>{if(!dotclear.colorsyntax)return;const t={mode:r||"text/html",tabMode:"indent",lineWrapping:"true",lineNumbers:"true",matchBrackets:"true",autoCloseBrackets:"true",readOnly:"true"};""!==dotclear.colorsyntax_theme&&(t.theme=dotclear.colorsyntax_theme);const o=document.getElementById(`${e}_source`);n=CodeMirror.fromTextArea(o,t)},close:()=>{null!=n&&n.toTextArea()}}})},r=document.querySelectorAll("a.tpl_compiled");for(const e of r)e.addEventListener("click",(e=>{e.preventDefault();const r=e.target.textContent;void 0!==r&&t(r,"tpl",(t=>{o("tpl_compiled",r,t,"php",e.target.title)}))}));if(document.getElementById("scform")){const r=e=>{e.preventDefault();const r=e.target.getAttribute("data-file");void 0!==r&&t(r,"sc",(t=>{o("sc_compiled",e.target.textContent,t)}))},c=document.querySelectorAll("a.sc_dir");for(const t of c)t.addEventListener("click",(t=>{t.preventDefault();const o=t.currentTarget.textContent;var c,n;c=o,n=c=>{const n=t.target.parentNode.parentNode;n.after(dotclear.htmlToNode(c)),n.remove();const l=document.querySelectorAll("a.sc_subdir");for(const t of l)t.addEventListener("click",(t=>{t.preventDefault();const c=t.currentTarget.textContent;var n,l;n=`${o}/${c}`,l=e=>{for(const e of document.querySelectorAll("a.sc_compiled"))e.removeEventListener("click",r);const o=t.target.parentNode.parentNode;o.after(dotclear.htmlToNode(e)),o.remove(),dotclear.condSubmit("#scform td input[type=checkbox]","#scform #delscaction");for(const e of document.querySelectorAll("a.sc_compiled"))e.addEventListener("click",r)},e("getStaticCacheList",{root:n},l,"")}))},e("getStaticCacheDir",{root:c},n,"")}))}if(document.getElementById("checklist")?.addEventListener("change",(e=>{e.currentTarget?.form.submit()})),document.getElementById("scform")&&document.getElementById("getscaction")?.addEventListener("click",(r=>{const c=e=>{e.preventDefault();const r=e.currentTarget.textContent,c=`${r.slice(0,2)}/${r.slice(2,4)}/${r.slice(4,6)}/${r}`,n=e.currentTarget.getAttribute("data-dir");t(`${n}/${c}`,"sc",(e=>{o("sc_compiled",r,e)}))};r.preventDefault();const n=document.getElementById("sccalc_res"),l=document.getElementById("sccalc_preview");n.textContent="",l.textContent="",l.removeEventListener("click",c);const s=document.getElementById("sccalc_url")?.value;void 0!==s&&""!==s&&((t,o)=>{e("getStaticCacheName",{url:t},o,"")})(s,(e=>{const t=`${String.fromCharCode(160)+e.slice(0,2)} / ${e.slice(2,4)} / ${e.slice(4,6)} / `;n.textContent=t,l.textContent=e,l.focus(),l.addEventListener("click",c)}))})),document.getElementById("tplform")){for(const e of document.querySelectorAll("#tplform .checkboxes-helpers"))dotclear.checkboxesHelpers(e,void 0,"#tplform td input[type=checkbox]:not(:disabled)","#tplform #deltplaction");dotclear.enableShiftClick("#tplform td input[type=checkbox]"),dotclear.condSubmit("#tplform td input[type=checkbox]","#tplform #deltplaction"),document.querySelector("form input[type=submit][name=deltplaction]")?.addEventListener("click",(e=>dotclear.confirm(dotclear.msg.confirm_del_tpl,e)))}if(document.getElementById("verform")){for(const e of document.querySelectorAll("#verform .checkboxes-helpers"))dotclear.checkboxesHelpers(e,void 0,"#verform td input[type=checkbox]:not(:disabled)","#verform #delveraction");dotclear.enableShiftClick("#verform td input[type=checkbox]"),dotclear.condSubmit("#verform td input[type=checkbox]","#verform #delveraction"),document.querySelector("form input[type=submit][name=delveraction]")?.addEventListener("click",(e=>dotclear.confirm(dotclear.msg.confirm_del_ver,e)))}if(document.getElementById("scform")){for(const e of document.querySelectorAll("#scform .checkboxes-helpers"))dotclear.checkboxesHelpers(e,void 0,"#scform td input[type=checkbox]:not(:disabled)","#scform #delscaction");dotclear.enableShiftClick("#scform td input[type=checkbox]"),dotclear.condSubmit("#scform td input[type=checkbox]","#scform #delscaction"),document.querySelector("form input[type=submit][name=delscaction]")?.addEventListener("click",(e=>dotclear.confirm(dotclear.msg.confirm_del_sc,e)))}document.getElementById("expand-all")?.addEventListener("click",(e=>{e.preventDefault();const t=document.querySelectorAll("#content details");if(e.currentTarget.getAttribute("open"))for(const e of t)e.removeAttribute("open");else for(const e of t)e.setAttribute("open","open")}));const c=document.getElementById("sys_battery");c&&(navigator.getBattery?navigator.getBattery().then((e=>{const t=100*e.level,[o]=c.getElementsByTagName("strong");o&&(o.innerText=`${t}%`)})):c.style.display="none");const n=(e,t=0,o=-1,r=-1)=>{const c=document.getElementById(e);if(!c)return;const n=c.querySelectorAll("th"),l=c.querySelector("tbody"),s=l.querySelectorAll("tr"),a=Array.from(n).map((()=>{})),d=(e,t)=>{const c=a[t]||"asc",d="asc"===c?1:-1,i=Array.from(s);i.sort(((c,n)=>{let l=c.querySelectorAll("td")[e].innerHTML,s=n.querySelectorAll("td")[e].innerHTML;if(o===t)return function(e,t){if(e===t)return 0;const o=e.split("."),r=t.split("."),c=Math.max(o.length,r.length);for(let e=0;e<c;e++){if(Number.parseInt(o[e])>Number.parseInt(r[e])||o[e]===r[e]&&Number.isNaN(r[e+1]))return 1*d;if(Number.parseInt(o[e])<Number.parseInt(r[e])||o[e]===r[e]&&Number.isNaN(o[e+1]))return-1*d}}(l,s);switch(r===t&&(l=Number.parseInt(c.querySelectorAll("td")[e].innerText),s=Number.parseInt(n.querySelectorAll("td")[e].innerText)),!0){case l>s:return 1*d;case l<s:return-1*d;case l===s:return 0}}));for(const e of s)l.removeChild(e);for(const e of i)l.appendChild(e);for(const e of n)e.classList.remove("sorted-asc"),e.classList.remove("sorted-desc");n[t].classList.add(`sorted-${c}`),a[t]="asc"===c?"desc":"asc"};if(n.length)for(let e=n.length-1;e>=0;e--)n[e].addEventListener("click",(()=>d(e+t,e)))};for(const e of["antispams","autoloads","constants","dotclear-config","dotclear-release","permissions","restmethods","tplpaths","urls","statuses_blog","statuses_user","statuses_post","statuses_comment","posttypes"])n(e);n("thumbnails",0,-1,1),n("statuses_blog",0,-1,2),n("statuses_user",0,-1,2),n("statuses_post",0,-1,2),n("statuses_comment",0,-1,2),n("exceptions",0,-1,2)}));
