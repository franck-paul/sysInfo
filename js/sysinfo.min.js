"use strict";$((()=>{dotclear.mergeDeep(dotclear,dotclear.getData("sysinfo"));const e=(e,t,c,o="")=>{let r=null;dotclear.servicesGet(e,(e=>{if($("rsp[status=failed]",e).length>0)return void window.console.log("Dotclear REST server error");const t=Number($("sysinfo",e).attr("ret"));r=$("sysinfo",e).attr("msg"),t&&void 0!==c&&"function"==typeof c&&c(r),t||""===o||window.alert(o)}),t)},t=(t,c,o)=>{switch(c){case"tpl":e("getCompiledTemplate",{file:t},o,dotclear.msg.tpl_not_found);break;case"sc":e("getStaticCacheFile",{file:t},o,dotclear.msg.sc_not_found)}},c=(e,t,c)=>{let o;const r=`<div class="${e}_view"><h1>${t}</h1><textarea id="${e}_source">${JSON.parse(window.atob(c))}</textarea></div>`;$.magnificPopup.open({items:{src:r,type:"inline"},callbacks:{open:()=>{if(dotclear.colorsyntax){const t={mode:"text/html",tabMode:"indent",lineWrapping:"true",lineNumbers:"true",matchBrackets:"true",autoCloseBrackets:"true",readOnly:"true"};""!==dotclear.colorsyntax_theme&&(t.theme=dotclear.colorsyntax_theme);const c=document.getElementById(`${e}_source`);o=CodeMirror.fromTextArea(c,t)}},close:()=>{null!=o&&o.toTextArea()}}})};$("a.tpl_compiled").on("click",(e=>{e.preventDefault();const o=$(e.target).text();void 0!==o&&t(o,"tpl",(e=>{c("tpl_compiled",o,e)}))})),$("a.sc_dir").on("click",(o=>{o.preventDefault();const r=$(o.target).text();var i;i=i=>{$(o.target).parent().parent().after(i).remove(),$("a.sc_subdir").on("click",(o=>{o.preventDefault();const i=$(o.target).text();e("getStaticCacheList",{root:`${r}/${i}`},(e=>{$("a.sc_compiled").off("click"),$(o.target).parent().parent().after(e).remove(),dotclear.condSubmit("#scform td input[type=checkbox]","#scform #delscaction"),$("a.sc_compiled").on("click",(e=>{e.preventDefault();const o=$(e.target).attr("data-file");void 0!==o&&t(o,"sc",(t=>{c("sc_compiled",$(e.target).text(),t)}))}))}),"")}))},e("getStaticCacheDir",{root:r},i,"")})),$("#checklist").on("change",(function(){this.form.submit()})),$("#getscaction").on("click",(o=>{o.preventDefault(),$("#sccalc_res").text(""),$("#sccalc_preview").text("").off("click");const r=$("#sccalc_url").val();void 0!==r&&""!==r&&((t,c)=>{e("getStaticCacheName",{url:t},c,"")})(r,(e=>{const o=`${String.fromCharCode(160)+e.slice(0,2)} / ${e.slice(2,4)} / ${e.slice(4,6)} / `;$("#sccalc_res").text(o),$("#sccalc_preview").text(e).trigger("focus"),$("#sccalc_preview").on("click",(o=>{o.preventDefault();const r=`${e.slice(0,2)}/${e.slice(2,4)}/${e.slice(4,6)}/${e}`;t(`${$(o.target).attr("data-dir")}/${r}`,"sc",(t=>{c("sc_compiled",e,t)}))}))}))})),$("#tplform .checkboxes-helpers").each((function(){dotclear.checkboxesHelpers(this,void 0,"#tplform td input[type=checkbox]:not(:disabled)","#tplform #deltplaction")})),$("#tplform td input[type=checkbox]").enableShiftClick(),dotclear.condSubmit("#tplform td input[type=checkbox]","#tplform #deltplaction"),$("form input[type=submit][name=deltplaction]").on("click",(()=>window.confirm(dotclear.msg.confirm_del_tpl))),$("#verform .checkboxes-helpers").each((function(){dotclear.checkboxesHelpers(this,void 0,"#verform td input[type=checkbox]:not(:disabled)","#verform #delveraction")})),$("#verform td input[type=checkbox]").enableShiftClick(),dotclear.condSubmit("#verform td input[type=checkbox]","#verform #delveraction"),$("form input[type=submit][name=delveraction]").on("click",(()=>window.confirm(dotclear.msg.confirm_del_ver))),$("#scform .checkboxes-helpers").each((function(){dotclear.checkboxesHelpers(this,void 0,"#scform td input[type=checkbox]:not(:disabled)","#scform #delscaction")})),$("#scform td input[type=checkbox]").enableShiftClick(),dotclear.condSubmit("#scform td input[type=checkbox]","#scform #delscaction"),$("form input[type=submit][name=delscaction]").on("click",(()=>window.confirm(dotclear.msg.confirm_del_sc))),$("#expand-all").on("click",(function(e){e.preventDefault(),$(this).attr("open")?$("#content details").each((function(){$(this).attr("open",!1)})):$("#content details").each((function(){$(this).attr("open",!0)}))}))}));
