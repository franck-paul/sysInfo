"use strict";dotclear.ready(()=>{dotclear.mergeDeep(dotclear,dotclear.getData("sysinfo"));const e=(e,t,r,o="")=>{dotclear.jsonServicesGet(e,e=>{r(e.html)},t,e=>{dotclear.debug&&console.log(e),globalThis.alert(o)})},t=(t,r,o)=>{switch(r){case"tpl":e("getCompiledTemplate",{file:t},o,dotclear.msg.tpl_not_found);break;case"sc":e("getStaticCacheFile",{file:t},o,dotclear.msg.sc_not_found)}},r=(e,t,r,o,c="")=>{let n;const s=""===c?"":`${c} - `,l=`<div class="${e}_view"><h1>${s}${t}</h1><textarea id="${e}_source">${JSON.parse(globalThis.atob(r))}</textarea></div>`;jQuery.magnificPopup.open({items:{src:l,type:"inline"},callbacks:{open:()=>{if(!dotclear.colorsyntax)return;const t={mode:o||"text/html",tabMode:"indent",lineWrapping:"true",lineNumbers:"true",matchBrackets:"true",autoCloseBrackets:"true",readOnly:"true"};""!==dotclear.colorsyntax_theme&&(t.theme=dotclear.colorsyntax_theme);const r=document.getElementById(`${e}_source`);n=CodeMirror.fromTextArea(r,t)},close:()=>{null!=n&&n.toTextArea()}}})},o=document.querySelectorAll("a.tpl_compiled");for(const e of o)e.addEventListener("click",e=>{e.preventDefault();const o=e.target.textContent;void 0!==o&&t(o,"tpl",t=>{r("tpl_compiled",o,t,"php",e.target.title)})});if(document.getElementById("scform")){const o=e=>{e.preventDefault();const o=e.target.dataset.file;void 0!==o&&t(o,"sc",t=>{r("sc_compiled",e.target.textContent,t)})},c=document.querySelectorAll("a.sc_dir");for(const t of c)t.addEventListener("click",t=>{t.preventDefault();const r=t.currentTarget.textContent;var c,n;c=r,n=c=>{const n=t.target.parentNode.parentNode;n.after(...dotclear.htmlToNodes(c)),n.remove();const s=document.querySelectorAll("a.sc_subdir");for(const t of s)t.addEventListener("click",t=>{t.preventDefault();const c=t.currentTarget.textContent;var n,s;n=`${r}/${c}`,s=e=>{for(const e of document.querySelectorAll("a.sc_compiled"))e.removeEventListener("click",o);const r=t.target.parentNode.parentNode;r.after(...dotclear.htmlToNodes(e)),r.remove(),dotclear.condSubmit("#scform td input[type=checkbox]","#scform #delscaction");for(const e of document.querySelectorAll("a.sc_compiled"))e.addEventListener("click",o)},e("getStaticCacheList",{root:n},s,"")})},e("getStaticCacheDir",{root:c},n,"")})}document.getElementById("checklist")?.addEventListener("change",e=>{e.currentTarget?.form.submit()}),document.getElementById("scform")&&document.getElementById("getscaction")?.addEventListener("click",o=>{const c=e=>{e.preventDefault();const o=e.currentTarget.textContent,c=`${o.slice(0,2)}/${o.slice(2,4)}/${o.slice(4,6)}/${o}`,n=e.currentTarget.dataset.dir;t(`${n}/${c}`,"sc",e=>{r("sc_compiled",o,e)})},n=(e,t="")=>`<a href="#sc_dir_${t}${e}">${e}</a>`;o.preventDefault();const s=document.getElementById("sccalc_res"),l=document.getElementById("sccalc_preview");s.textContent="",l.textContent="",l.removeEventListener("click",c);const a=document.getElementById("sccalc_url")?.value;void 0!==a&&""!==a&&((t,r)=>{e("getStaticCacheName",{url:t},r,"")})(a,e=>{const t=`${String.fromCodePoint(160)}${n(e.slice(0,2))} / ${n(e.slice(2,4),e.slice(0,2))} / ${n(e.slice(4,6),e.slice(0,4))} / `;s.innerHTML=t,l.textContent=e,l.focus(),l.addEventListener("click",c)})});const c=(e,t,r)=>{if(document.getElementById(e)){for(const r of document.querySelectorAll(`#${e} .checkboxes-helpers`))dotclear.checkboxesHelpers(r,void 0,`#${e} td input[type=checkbox]:not(:disabled)`,`#${e} #${t}`);dotclear.enableShiftClick(`#${e} td input[type=checkbox]`),dotclear.condSubmit(`#${e} td input[type=checkbox]`,`#${e} #${t}`),document.querySelector(`form input[type=submit][name=${t}]`)?.addEventListener("click",e=>dotclear.confirm(r,e))}};c("tplform","deltplaction",dotclear.msg.confirm_del_tpl),c("verform","delveraction",dotclear.msg.confirm_del_ver),c("scform","delscaction",dotclear.msg.confirm_del_sc),c("udform","deludaction",dotclear.msg.confirm_del_ud),document.getElementById("expand-all")?.addEventListener("click",e=>{e.preventDefault();const t=document.querySelectorAll("#content details");if(e.currentTarget.getAttribute("open"))for(const e of t)e.removeAttribute("open");else for(const e of t)e.setAttribute("open","open")});const n=document.getElementById("sys_battery");n&&(navigator.getBattery?navigator.getBattery().then(e=>{const t=100*e.level,[r]=n.getElementsByTagName("strong");r&&(r.innerText=`${t}%`)}):n.style.display="none");const s=document.getElementById("attic");s&&e("getAtticVersions",{},e=>{s.outerHTML=e});const l=(e,t=0,r=-1,o=-1)=>{const c=document.getElementById(e);if(!c)return;c.classList.add("js-sortable");const n=c.querySelectorAll("th");for(const e of n)e.innerText&&e.setAttribute("tabindex","0");const s=c.querySelector("tbody"),l=s.querySelectorAll("tr"),a=Array.from(n).map(()=>{}),d=(e,t)=>{const c=a[t]||"asc",d="asc"===c?1:-1,i=Array.from(l);i.sort((c,n)=>{let s=c.querySelectorAll("td")[e].innerHTML,l=n.querySelectorAll("td")[e].innerHTML;if(r===t)return function(e,t){if(e===t)return 0;const r=e.split("."),o=t.split("."),c=Math.max(r.length,o.length);for(let e=0;e<c;e++){if(Number.parseInt(r[e])>Number.parseInt(o[e])||r[e]===o[e]&&Number.isNaN(o[e+1]))return 1*d;if(Number.parseInt(r[e])<Number.parseInt(o[e])||r[e]===o[e]&&Number.isNaN(r[e+1]))return-1*d}}(s,l);if(o===t)switch(s=Number.parseInt(c.querySelectorAll("td")[e].innerText),l=Number.parseInt(n.querySelectorAll("td")[e].innerText),!0){case s>l:return 1*d;case s<l:return-1*d;case s===l:return 0}return s.localeCompare(l)*d});for(const e of l)e.remove();for(const e of i)s.appendChild(e);for(const e of n)e.classList.remove("sorted-asc","sorted-desc");n[t].classList.add(`sorted-${c}`),a[t]="asc"===c?"desc":"asc"};if(n.length)for(let e=n.length-1;e>=0;e--)n[e].addEventListener("click",()=>d(e+t,e)),n[e].addEventListener("keypress",e=>{"Enter"===e.key&&(e.target.click(),e.preventDefault())})};for(const e of["antispams","autoloads","constants","dbdrivers","dotclear-config","dotclear-release","permissions","restmethods","tplpaths","urls","statuses_blog","statuses_user","statuses_post","statuses_comment","posttypes"])l(e);l("thumbnails",0,-1,1),l("statuses_blog",0,-1,2),l("statuses_user",0,-1,2),l("statuses_post",0,-1,2),l("statuses_comment",0,-1,2),l("exceptions",0,-1,2)});
