"use strict";window.addEventListener("load",(()=>{dotclear.mergeDeep(dotclear,dotclear.getData("sysinfo"));const e=(e,t,c,o="")=>{dotclear.jsonServicesGet(e,(e=>{c(e.html)}),t,(e=>{dotclear.debug&&console.log(e),window.alert(o)}))},t=(t,c,o)=>{switch(c){case"tpl":e("getCompiledTemplate",{file:t},o,dotclear.msg.tpl_not_found);break;case"sc":e("getStaticCacheFile",{file:t},o,dotclear.msg.sc_not_found)}},c=(e,t,c,o,r="")=>{let a;const l=`<div class="${e}_view"><h1>${""===r?"":`${r} - `}${t}</h1><textarea id="${e}_source">${JSON.parse(window.atob(c))}</textarea></div>`;$.magnificPopup.open({items:{src:l,type:"inline"},callbacks:{open:()=>{if(!dotclear.colorsyntax)return;const t={mode:o||"text/html",tabMode:"indent",lineWrapping:"true",lineNumbers:"true",matchBrackets:"true",autoCloseBrackets:"true",readOnly:"true"};""!==dotclear.colorsyntax_theme&&(t.theme=dotclear.colorsyntax_theme);const c=document.getElementById(`${e}_source`);a=CodeMirror.fromTextArea(c,t)},close:()=>{null!=a&&a.toTextArea()}}})};$("a.tpl_compiled").on("click",(e=>{e.preventDefault();const o=$(e.target).text();void 0!==o&&t(o,"tpl",(t=>{c("tpl_compiled",o,t,"php",e.target.title)}))})),$("a.sc_dir").on("click",(o=>{o.preventDefault();const r=$(o.target).text();var a;a=a=>{$(o.target).parent().parent().after(a).remove(),$("a.sc_subdir").on("click",(o=>{o.preventDefault();const a=$(o.target).text();e("getStaticCacheList",{root:`${r}/${a}`},(e=>{$("a.sc_compiled").off("click"),$(o.target).parent().parent().after(e).remove(),dotclear.condSubmit("#scform td input[type=checkbox]","#scform #delscaction"),$("a.sc_compiled").on("click",(e=>{e.preventDefault();const o=$(e.target).attr("data-file");void 0!==o&&t(o,"sc",(t=>{c("sc_compiled",$(e.target).text(),t)}))}))}),"")}))},e("getStaticCacheDir",{root:r},a,"")})),$("#checklist").on("change",(function(){this.form.submit()})),$("#getscaction").on("click",(o=>{o.preventDefault(),$("#sccalc_res").text(""),$("#sccalc_preview").text("").off("click");const r=$("#sccalc_url").val();void 0!==r&&""!==r&&((t,c)=>{e("getStaticCacheName",{url:t},c,"")})(r,(e=>{const o=`${String.fromCharCode(160)+e.slice(0,2)} / ${e.slice(2,4)} / ${e.slice(4,6)} / `;$("#sccalc_res").text(o),$("#sccalc_preview").text(e).trigger("focus"),$("#sccalc_preview").on("click",(o=>{o.preventDefault();const r=`${e.slice(0,2)}/${e.slice(2,4)}/${e.slice(4,6)}/${e}`;t(`${$(o.target).attr("data-dir")}/${r}`,"sc",(t=>{c("sc_compiled",e,t)}))}))}))})),$("#tplform .checkboxes-helpers").each((function(){dotclear.checkboxesHelpers(this,void 0,"#tplform td input[type=checkbox]:not(:disabled)","#tplform #deltplaction")})),dotclear.enableShiftClick("#tplform td input[type=checkbox]"),dotclear.condSubmit("#tplform td input[type=checkbox]","#tplform #deltplaction"),$("form input[type=submit][name=deltplaction]").on("click",(()=>window.confirm(dotclear.msg.confirm_del_tpl))),$("#verform .checkboxes-helpers").each((function(){dotclear.checkboxesHelpers(this,void 0,"#verform td input[type=checkbox]:not(:disabled)","#verform #delveraction")})),dotclear.enableShiftClick("#verform td input[type=checkbox]"),dotclear.condSubmit("#verform td input[type=checkbox]","#verform #delveraction"),$("form input[type=submit][name=delveraction]").on("click",(()=>window.confirm(dotclear.msg.confirm_del_ver))),$("#scform .checkboxes-helpers").each((function(){dotclear.checkboxesHelpers(this,void 0,"#scform td input[type=checkbox]:not(:disabled)","#scform #delscaction")})),dotclear.enableShiftClick("#scform td input[type=checkbox]"),dotclear.condSubmit("#scform td input[type=checkbox]","#scform #delscaction"),$("form input[type=submit][name=delscaction]").on("click",(()=>window.confirm(dotclear.msg.confirm_del_sc))),$("#expand-all").on("click",(function(e){e.preventDefault(),$(this).attr("open")?$("#content details").each((function(){$(this).attr("open",!1)})):$("#content details").each((function(){$(this).attr("open",!0)}))}));const o=document.getElementById("sys_battery");o&&(navigator.getBattery?navigator.getBattery().then((e=>{const t=100*e.level,c=o.getElementsByTagName("strong");c.length&&(c[0].innerHTML=`${t}%`)})):o.style.display="none")}));
