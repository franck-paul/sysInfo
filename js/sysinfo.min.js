"use strict";dotclear.ready((()=>{dotclear.mergeDeep(dotclear,dotclear.getData("sysinfo"));const e=(e,t,o,c="")=>{dotclear.jsonServicesGet(e,(e=>{o(e.html)}),t,(e=>{dotclear.debug&&console.log(e),window.alert(c)}))},t=(t,o,c)=>{switch(o){case"tpl":e("getCompiledTemplate",{file:t},c,dotclear.msg.tpl_not_found);break;case"sc":e("getStaticCacheFile",{file:t},c,dotclear.msg.sc_not_found)}},o=(e,t,o,c,r="")=>{let n;const l=""===r?"":`${r} - `,s=`<div class="${e}_view"><h1>${l}${t}</h1><textarea id="${e}_source">${JSON.parse(window.atob(o))}</textarea></div>`;jQuery.magnificPopup.open({items:{src:s,type:"inline"},callbacks:{open:()=>{if(!dotclear.colorsyntax)return;const t={mode:c||"text/html",tabMode:"indent",lineWrapping:"true",lineNumbers:"true",matchBrackets:"true",autoCloseBrackets:"true",readOnly:"true"};""!==dotclear.colorsyntax_theme&&(t.theme=dotclear.colorsyntax_theme);const o=document.getElementById(`${e}_source`);n=CodeMirror.fromTextArea(o,t)},close:()=>{null!=n&&n.toTextArea()}}})},c=document.querySelectorAll("a.tpl_compiled");for(const e of c)e.addEventListener("click",(e=>{e.preventDefault();const c=e.target.textContent;void 0!==c&&t(c,"tpl",(t=>{o("tpl_compiled",c,t,"php",e.target.title)}))}));if(document.getElementById("scform")){const c=e=>{e.preventDefault();const c=e.target.getAttribute("data-file");void 0!==c&&t(c,"sc",(t=>{o("sc_compiled",e.target.textContent,t)}))},r=document.querySelectorAll("a.sc_dir");for(const t of r)t.addEventListener("click",(t=>{t.preventDefault();const o=t.currentTarget.textContent;var r,n;r=o,n=r=>{const n=t.target.parentNode.parentNode;n.after(dotclear.htmlToNode(r)),n.remove();const l=document.querySelectorAll("a.sc_subdir");for(const t of l)t.addEventListener("click",(t=>{t.preventDefault();const r=t.currentTarget.textContent;var n,l;n=`${o}/${r}`,l=e=>{for(const e of document.querySelectorAll("a.sc_compiled"))e.removeEventListener("click",c);const o=t.target.parentNode.parentNode;o.after(dotclear.htmlToNode(e)),o.remove(),dotclear.condSubmit("#scform td input[type=checkbox]","#scform #delscaction");for(const e of document.querySelectorAll("a.sc_compiled"))e.addEventListener("click",c)},e("getStaticCacheList",{root:n},l,"")}))},e("getStaticCacheDir",{root:r},n,"")}))}if(document.getElementById("checklist")?.addEventListener("change",(e=>{e.currentTarget?.form.submit()})),document.getElementById("scform")&&document.getElementById("getscaction")?.addEventListener("click",(c=>{const r=e=>{e.preventDefault();const c=e.currentTarget.textContent,r=`${c.slice(0,2)}/${c.slice(2,4)}/${c.slice(4,6)}/${c}`,n=e.currentTarget.getAttribute("data-dir");t(`${n}/${r}`,"sc",(e=>{o("sc_compiled",c,e)}))};c.preventDefault();const n=document.getElementById("sccalc_res"),l=document.getElementById("sccalc_preview");n.textContent="",l.textContent="",l.removeEventListener("click",r);const s=document.getElementById("sccalc_url")?.value;void 0!==s&&""!==s&&((t,o)=>{e("getStaticCacheName",{url:t},o,"")})(s,(e=>{const t=`${String.fromCharCode(160)+e.slice(0,2)} / ${e.slice(2,4)} / ${e.slice(4,6)} / `;n.textContent=t,l.textContent=e,l.focus(),l.addEventListener("click",r)}))})),document.getElementById("tplform")){for(const e of document.querySelectorAll("#tplform .checkboxes-helpers"))dotclear.checkboxesHelpers(e,void 0,"#tplform td input[type=checkbox]:not(:disabled)","#tplform #deltplaction");dotclear.enableShiftClick("#tplform td input[type=checkbox]"),dotclear.condSubmit("#tplform td input[type=checkbox]","#tplform #deltplaction"),document.querySelector("form input[type=submit][name=deltplaction]")?.addEventListener("click",(e=>dotclear.confirm(dotclear.msg.confirm_del_tpl,e)))}if(document.getElementById("verform")){for(const e of document.querySelectorAll("#verform .checkboxes-helpers"))dotclear.checkboxesHelpers(e,void 0,"#verform td input[type=checkbox]:not(:disabled)","#verform #delveraction");dotclear.enableShiftClick("#verform td input[type=checkbox]"),dotclear.condSubmit("#verform td input[type=checkbox]","#verform #delveraction"),document.querySelector("form input[type=submit][name=delveraction]")?.addEventListener("click",(e=>dotclear.confirm(dotclear.msg.confirm_del_ver,e)))}if(document.getElementById("scform")){for(const e of document.querySelectorAll("#scform .checkboxes-helpers"))dotclear.checkboxesHelpers(e,void 0,"#scform td input[type=checkbox]:not(:disabled)","#scform #delscaction");dotclear.enableShiftClick("#scform td input[type=checkbox]"),dotclear.condSubmit("#scform td input[type=checkbox]","#scform #delscaction"),document.querySelector("form input[type=submit][name=delscaction]")?.addEventListener("click",(e=>dotclear.confirm(dotclear.msg.confirm_del_sc,e)))}document.getElementById("expand-all")?.addEventListener("click",(e=>{e.preventDefault();const t=document.querySelectorAll("#content details");if(e.currentTarget.getAttribute("open"))for(const e of t)e.removeAttribute("open");else for(const e of t)e.setAttribute("open","open")}));const r=document.getElementById("sys_battery");r&&(navigator.getBattery?navigator.getBattery().then((e=>{const t=100*e.level,[o]=r.getElementsByTagName("strong");o&&(o.innerText=`${t}%`)})):r.style.display="none");const n=(e,t=0,o=-1)=>{const c=document.getElementById(e);if(!c)return;const r=c.querySelectorAll("th"),n=c.querySelector("tbody"),l=n.querySelectorAll("tr"),s=Array.from(r).map((()=>{})),a=(e,t)=>{const c=s[t]||"asc",a="asc"===c?1:-1,d=Array.from(l);d.sort(((c,r)=>{const n=c.querySelectorAll("td")[e].innerHTML,l=r.querySelectorAll("td")[e].innerHTML;if(o===t)return function(e,t){if(e===t)return 0;const o=e.split("."),c=t.split("."),r=Math.max(o.length,c.length);for(let e=0;e<r;e++){if(Number.parseInt(o[e])>Number.parseInt(c[e])||o[e]===c[e]&&Number.isNaN(c[e+1]))return 1*a;if(Number.parseInt(o[e])<Number.parseInt(c[e])||o[e]===c[e]&&Number.isNaN(o[e+1]))return-1*a}}(n,l);switch(!0){case n>l:return 1*a;case n<l:return-1*a;case n===l:return 0}}));for(const e of l)n.removeChild(e);for(const e of d)n.appendChild(e);for(const e of r)e.classList.remove("sorted-asc"),e.classList.remove("sorted-desc");r[t].classList.add(`sorted-${c}`),s[t]="asc"===c?"desc":"asc"};if(r.length)for(let e=r.length-1;e>=0;e--)r[e].addEventListener("click",(()=>a(e+t,e)))};for(const e of["antispams","autoloads","constants","dotclear-config","dotclear-release","exceptions","permissions","restmethods","tplpaths","urls"])n(e)}));
